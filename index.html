<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enterprise Sales Tracker</title>

<style>
:root {
 --primary:#2563eb;
 --bg:#f8fafc;
 --surface:#ffffff;
 --text-main:#1e293b;
 --text-light:#64748b;
 --border:#e2e8f0;
 --danger:#ef4444;
}

body{
 font-family:Arial;
 background:var(--bg);
 margin:0;
 padding:20px;
}

header{
 display:flex;
 justify-content:space-between;
 background:white;
 padding:16px 24px;
 border-radius:12px;
 margin-bottom:20px;
}

.btn{
 background:var(--primary);
 color:white;
 border:none;
 padding:10px 20px;
 border-radius:8px;
 cursor:pointer;
}

.table-container{
 background:white;
 border-radius:12px;
 overflow:auto;
}

table{
 width:100%;
 border-collapse:collapse;
}

th{
 background:#f1f5f9;
 padding:12px;
 text-align:left;
}

td{
 padding:12px;
 border-bottom:1px solid var(--border);
 color:var(--text-light);
}

.modal-overlay{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,0.5);
 display:flex;
 justify-content:center;
 align-items:center;
 opacity:0;
 pointer-events:none;
}

.modal-overlay.open{
 opacity:1;
 pointer-events:auto;
}

.modal{
 background:white;
 width:90%;
 max-width:800px;
 border-radius:16px;
 padding:24px;
}

.form-grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
 gap:16px;
}

input,select{
 padding:10px;
 border:1px solid var(--border);
 border-radius:6px;
}

.actions-cell button{
 margin-right:6px;
}
</style>
</head>

<body>

<header>
<h2>üöÄ Sales & Service Tracker</h2>
<button class="btn" onclick="openModal()">+ Add New Entry</button>
</header>

<div class="table-container">
<table>
<thead>
<tr>
<th>Entity</th>
<th>Customer</th>
<th>Speed</th>
<th>Location</th>
<th>Connectivity</th>
<th>Status</th>
<th>Months</th>
<th>Devices</th>
<th>Price</th>
<th>Payment</th>
<th>PO Expiry</th>
<th>Service Stop</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div class="modal-overlay" id="modalOverlay">
<div class="modal">

<form id="salesForm" onsubmit="handleFormSubmit(event)">
<input type="hidden" id="entryId">

<div class="form-grid">
<input id="entity" name="entity" placeholder="Entity" required>
<input id="customerName" name="customerName" placeholder="Customer Name" required>
<input id="speed" name="speed" placeholder="Speed">
<input id="location" name="location" placeholder="Location">

<select id="connectivity" name="connectivity">
<option>Fiber</option>
<option>Wireless</option>
<option>LTE/5G</option>
</select>

<select id="deliveryStatus" name="deliveryStatus">
<option>Pending</option>
<option>Active</option>
<option>Inactive</option>
</select>

<input id="months" name="months" placeholder="Months">
<input id="devices" name="devices" placeholder="Devices">
<input id="price" name="price" placeholder="Price">

<select id="paymentStatus" name="paymentStatus">
<option>Unpaid</option>
<option>Paid</option>
<option>Overdue</option>
</select>

<input type="date" id="poExpiryDate" name="poExpiryDate">
<input type="date" id="serviceStopDate" name="serviceStopDate">
</div>

<br>
<button class="btn" type="submit">Save Record</button>
<button class="btn" type="button" onclick="closeModal()">Cancel</button>

</form>

</div>
</div>

<!-- ‚úÖ SUPABASE SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

/* ======================
   SUPABASE CONNECTION
====================== */

const supabaseUrl="https://jhvujuqzkjbprmshizcx.supabase.co";
const supabaseKey="sb_publishable_F_SEkmGLAe00CNrXVbce6g_H1LK5006";

const supabase=window.supabase.createClient(
 supabaseUrl,
 supabaseKey
);

/* ======================
   STATE
====================== */

let salesData=[];
let editingId=null;

const modal=document.getElementById('modalOverlay');
const form=document.getElementById('salesForm');
const tableBody=document.getElementById('tableBody');

/* ======================
   MODAL FUNCTIONS
====================== */

function openModal(){
 editingId=null;
 form.reset();
 modal.classList.add('open');
}

function closeModal(){
 modal.classList.remove('open');
}

/* ======================
   LOAD DATA
====================== */

async function loadData(){

 const {data,error}=await supabase
 .from("sales_entries")
 .select("*")
 .order("id",{ascending:false});

 if(error){console.log(error);return;}

 salesData=data||[];
 renderTable();
}

/* ======================
   SAVE ENTRY
====================== */

async function handleFormSubmit(e){
 e.preventDefault();

 const formData=new FormData(e.target);
 const entry=Object.fromEntries(formData.entries());

 if(editingId){
  await supabase.from("sales_entries")
  .update(entry)
  .eq("id",editingId);
 }else{
  await supabase.from("sales_entries")
  .insert([entry]);
 }

 closeModal();
 loadData();
}

/* ======================
   DELETE
====================== */

async function deleteEntry(id){
 if(!confirm("Delete this record?")) return;

 await supabase.from("sales_entries")
 .delete()
 .eq("id",id);

 loadData();
}

/* ======================
   EDIT
====================== */

function editEntry(id){
 const item=salesData.find(x=>x.id===id);
 if(!item) return;

 editingId=id;

 Object.keys(item).forEach(k=>{
  const el=document.getElementById(k);
  if(el) el.value=item[k];
 });

 modal.classList.add('open');
}

/* ======================
   RENDER TABLE
====================== */

function renderTable(){
 tableBody.innerHTML="";

 salesData.forEach(item=>{
 tableBody.innerHTML+=`
 <tr>
 <td>${item.entity||""}</td>
 <td>${item.customerName||""}</td>
 <td>${item.speed||""}</td>
 <td>${item.location||""}</td>
 <td>${item.connectivity||""}</td>
 <td>${item.deliveryStatus||""}</td>
 <td>${item.months||""}</td>
 <td>${item.devices||""}</td>
 <td>${item.price||""}</td>
 <td>${item.paymentStatus||""}</td>
 <td>${item.poExpiryDate||""}</td>
 <td>${item.serviceStopDate||""}</td>
 <td class="actions-cell">
 <button onclick="editEntry(${item.id})">‚úèÔ∏è</button>
 <button onclick="deleteEntry(${item.id})">üóëÔ∏è</button>
 </td>
 </tr>`;
 });
}

/* ======================
   INITIAL LOAD
====================== */

loadData();

</script>

</body>
</html>
