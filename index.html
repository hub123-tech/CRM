<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Company CRM Cloud</title>

<style>
body{
 font-family:Arial;
 background:#f4f6fb;
 margin:0;
 padding:20px;
}

h2{margin:0;}

.topbar{
 display:flex;
 justify-content:space-between;
 align-items:center;
 background:white;
 padding:15px 20px;
 border-radius:10px;
 margin-bottom:20px;
 box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

button{
 background:#2563eb;
 color:white;
 border:none;
 padding:10px 18px;
 border-radius:8px;
 cursor:pointer;
}

table{
 width:100%;
 background:white;
 border-collapse:collapse;
 border-radius:10px;
 overflow:hidden;
}

th,td{
 padding:12px;
 border-bottom:1px solid #eee;
 font-size:14px;
}

th{background:#f1f5f9;text-align:left;}

/* ===== MODAL FIX ===== */

.modal{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,0.4);
 display:none;
 align-items:center;
 justify-content:center;
 z-index:9999;
}

.modal.show{
 display:flex;
}

.modal-box{
 background:white;
 padding:20px;
 border-radius:12px;
 width:95%;
 max-width:900px;
}

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
 gap:10px;
}

input,select{
 padding:8px;
 border:1px solid #ccc;
 border-radius:6px;
}
</style>
</head>

<body>

<div class="topbar">
<h2>ðŸš€ Company CRM (Cloud Version)</h2>
<button onclick="openModal()">+ Add Entry</button>
</div>

<table>
<thead>
<tr>
<th>Entity</th>
<th>Customer</th>
<th>Speed</th>
<th>Location</th>
<th>Connectivity</th>
<th>Status</th>
<th>Months</th>
<th>Devices</th>
<th>Price</th>
<th>Excl GST</th>
<th>Incl GST</th>
<th>Payment</th>
<th>Start</th>
<th>End</th>
<th>PO Expiry</th>
<th>Service Stop</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<!-- ===== MODAL ===== -->

<div class="modal" id="modal">
<div class="modal-box">

<h3>Add CRM Entry</h3>

<form id="crmForm">
<div class="grid">

<input id="entity" placeholder="Entity">
<input id="customerName" placeholder="Customer">
<input id="speed" placeholder="Speed">
<input id="location" placeholder="Location">

<select id="connectivity">
<option>Fiber</option>
<option>Wireless</option>
<option>LTE</option>
</select>

<select id="deliveryStatus">
<option>Active</option>
<option>Pending</option>
<option>Inactive</option>
</select>

<input id="months" placeholder="Months">
<input id="devices" placeholder="Devices">
<input id="price" placeholder="Price">
<input id="exclGst" placeholder="Excl GST">
<input id="inclGst" placeholder="Incl GST">

<select id="paymentStatus">
<option>Paid</option>
<option>Unpaid</option>
<option>Overdue</option>
</select>

<input id="startDate" type="date">
<input id="endDate" type="date">
<input id="poExpiryDate" type="date">
<input id="serviceStopDate" type="date">

</div>

<br>
<button type="submit">Save Entry</button>
<button type="button" onclick="closeModal()">Cancel</button>

</form>

</div>
</div>

<!-- ===== SUPABASE SDK ===== -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ===== SUPABASE CONFIG ===== */

const supabaseUrl = "https://jhvujuqzkjbprmshizcx.supabase.co";

/* ðŸ”´ PASTE YOUR FULL sb_publishable KEY BELOW */
const supabaseKey = "sb_publishable_F_SEkmGLAe00CNrXVbce6g_H1LK5006";

const supabase = window.supabase.createClient(
 supabaseUrl,
 supabaseKey
);

const modal=document.getElementById("modal");
const form=document.getElementById("crmForm");
const tableBody=document.getElementById("tableBody");

/* ===== MODAL FIXED FUNCTIONS ===== */

function openModal(){
 modal.classList.add("show");
}

function closeModal(){
 modal.classList.remove("show");
}

/* ===== LOAD DATA ===== */

async function loadData(){

 const {data,error}=await supabase
  .from("sales_entries")
  .select("*")
  .order("id",{ascending:false});

 if(error){
  console.log(error);
  return;
 }

 tableBody.innerHTML="";

 data.forEach(d=>{
  tableBody.innerHTML+=`
  <tr>
   <td>${d.entity||""}</td>
   <td>${d.customername||""}</td>
   <td>${d.speed||""}</td>
   <td>${d.location||""}</td>
   <td>${d.connectivity||""}</td>
   <td>${d.deliverystatus||""}</td>
   <td>${d.months||""}</td>
   <td>${d.devices||""}</td>
   <td>${d.price||""}</td>
   <td>${d.exclgst||""}</td>
   <td>${d.inclgst||""}</td>
   <td>${d.paymentstatus||""}</td>
   <td>${d.startdate||""}</td>
   <td>${d.enddate||""}</td>
   <td>${d.poexpirydate||""}</td>
   <td>${d.servicestopdate||""}</td>
  </tr>`;
 });

}

/* ===== ADD ENTRY FIXED ===== */

form.addEventListener("submit",async(e)=>{
 e.preventDefault();

 const newData={
  entity:entity.value,
  customername:customerName.value,
  speed:speed.value,
  location:location.value,
  connectivity:connectivity.value,
  deliverystatus:deliveryStatus.value,
  months:months.value,
  devices:devices.value,
  price:price.value,
  exclgst:exclGst.value,
  inclgst:inclGst.value,
  paymentstatus:paymentStatus.value,
  startdate:startDate.value,
  enddate:endDate.value,
  poexpirydate:poExpiryDate.value,
  servicestopdate:serviceStopDate.value
 };

 const {error}=await supabase
  .from("sales_entries")
  .insert([newData]);

 if(error){
  alert("Insert Error");
  console.log(error);
  return;
 }

 closeModal();
 form.reset();
 loadData();

});

loadData();
</script>

</body>
</html>
