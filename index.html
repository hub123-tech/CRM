<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Company CRM Cloud</title>

<style>
body{
 font-family: Arial;
 background:#f4f6fb;
 padding:20px;
}

.header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 background:white;
 padding:15px;
 border-radius:10px;
 box-shadow:0 3px 8px rgba(0,0,0,.08);
 margin-bottom:20px;
}

button{
 background:#2563eb;
 color:white;
 border:none;
 padding:10px 16px;
 border-radius:6px;
 cursor:pointer;
}

table{
 width:100%;
 border-collapse:collapse;
 background:white;
 border-radius:10px;
 overflow:hidden;
 box-shadow:0 3px 8px rgba(0,0,0,.08);
}

th,td{
 padding:10px;
 border-bottom:1px solid #eee;
 font-size:14px;
 text-align:left;
}

th{
 background:#f1f5f9;
}

.modal{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,.4);
 display:none;
 justify-content:center;
 align-items:center;
}

.modal-box{
 background:white;
 padding:20px;
 border-radius:10px;
 width:400px;
}

input,select{
 width:100%;
 padding:8px;
 margin:5px 0;
}
</style>
</head>

<body>

<div class="header">
<h2>ðŸš€ Company CRM (Cloud Version)</h2>
<button onclick="openModal()">+ Add Entry</button>
</div>

<table>
<thead>
<tr>
<th>Entity</th>
<th>Customer</th>
<th>Speed</th>
<th>Location</th>
<th>Connectivity</th>
<th>Status</th>
<th>Months</th>
<th>Devices</th>
<th>Price</th>
<th>Excl GST</th>
<th>Incl GST</th>
<th>Payment</th>
<th>Start</th>
<th>End</th>
<th>PO Expiry</th>
<th>Service Stop</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>
</table>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-box">

<input id="entity" placeholder="Entity">
<input id="customerName" placeholder="Customer Name">
<input id="speed" placeholder="Speed">
<input id="location" placeholder="Location">
<input id="connectivity" placeholder="Connectivity">
<input id="deliveryStatus" placeholder="Status">
<input id="months" placeholder="Months">
<input id="devices" placeholder="Devices">
<input id="price" placeholder="Price">
<input id="exclGst" placeholder="Excl GST">
<input id="inclGst" placeholder="Incl GST">
<input id="paymentStatus" placeholder="Payment Status">
<input id="startDate" type="date">
<input id="endDate" type="date">
<input id="poExpiryDate" type="date">
<input id="serviceStopDate" type="date">

<br>
<button onclick="saveEntry()">Save</button>
<button onclick="closeModal()">Close</button>

</div>
</div>

<!-- SUPABASE SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* =============================
   SUPABASE CONNECTION
============================= */

const supabaseUrl = "https://jhvujuqzkjbprmshizcx.supabase.coL";
const supabaseKey = "sb_publishable_F_SEkmGLAe00CNrXVbce6g_H1LK5006;

const supabase = window.supabase.createClient(
 supabaseUrl,
 supabaseKey
);

console.log("Supabase Connected");

/* =============================
   UI FUNCTIONS
============================= */

function openModal(){
 document.getElementById("modal").style.display="flex";
}

function closeModal(){
 document.getElementById("modal").style.display="none";
}

/* =============================
   SAVE ENTRY (CLOUD)
============================= */

async function saveEntry(){

 const data = {
  entity: entity.value,
  customerName: customerName.value,
  speed: speed.value,
  location: location.value,
  connectivity: connectivity.value,
  deliveryStatus: deliveryStatus.value,
  months: months.value,
  devices: devices.value,
  price: price.value,
  exclGst: exclGst.value,
  inclGst: inclGst.value,
  paymentStatus: paymentStatus.value,
  startDate: startDate.value,
  endDate: endDate.value,
  poExpiryDate: poExpiryDate.value,
  serviceStopDate: serviceStopDate.value
 };

 const { error } = await supabase
   .from("sales_entries")
   .insert([data]);

 if(error){
   alert("Error saving data");
   console.log(error);
   return;
 }

 closeModal();
 loadData();
}

/* =============================
   LOAD DATA FROM CLOUD
============================= */

async function loadData(){

 const { data, error } = await supabase
   .from("sales_entries")
   .select("*")
   .order("id",{ascending:false});

 if(error){
   console.log(error);
   return;
 }

 const table=document.getElementById("tableBody");
 table.innerHTML="";

 data.forEach(d=>{
  table.innerHTML+=`
   <tr>
   <td>${d.entity||""}</td>
   <td>${d.customername||d.customerName||""}</td>
   <td>${d.speed||""}</td>
   <td>${d.location||""}</td>
   <td>${d.connectivity||""}</td>
   <td>${d.deliverystatus||d.deliveryStatus||""}</td>
   <td>${d.months||""}</td>
   <td>${d.devices||""}</td>
   <td>${d.price||""}</td>
   <td>${d.exclgst||d.exclGst||""}</td>
   <td>${d.inclgst||d.inclGst||""}</td>
   <td>${d.paymentstatus||d.paymentStatus||""}</td>
   <td>${d.startdate||d.startDate||""}</td>
   <td>${d.enddate||d.endDate||""}</td>
   <td>${d.poexpirydate||d.poExpiryDate||""}</td>
   <td>${d.servicestopdate||d.serviceStopDate||""}</td>
   </tr>
  `;
 });
}

/* =============================
   INITIAL LOAD
============================= */

loadData();

</script>
</body>
</html>
