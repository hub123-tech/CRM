<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Company Cloud CRM</title>

<style>
body{
 font-family:Arial;
 background:#f8fafc;
 margin:0;
 padding:20px;
}
header{
 display:flex;
 justify-content:space-between;
 background:white;
 padding:15px;
 border-radius:10px;
 margin-bottom:15px;
}
.btn{
 background:#2563eb;
 color:white;
 border:none;
 padding:10px 15px;
 border-radius:6px;
 cursor:pointer;
}
table{
 width:100%;
 border-collapse:collapse;
 background:white;
}
th,td{
 padding:10px;
 border-bottom:1px solid #eee;
}
.modal{
 position:fixed;
 top:0;left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,0.5);
 display:none;
 justify-content:center;
 align-items:center;
}
.modal-box{
 background:white;
 padding:20px;
 border-radius:10px;
 width:90%;
 max-width:700px;
}
.form-grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
 gap:10px;
}
input,select{
 padding:8px;
}
</style>
</head>

<body>

<header>
<h2>ðŸš€ Company CRM (Cloud Version)</h2>
<button class="btn" onclick="openModal()">+ Add Entry</button>
</header>

<table>
<thead>
<tr>
<th>Entity</th>
<th>Customer</th>
<th>Speed</th>
<th>Location</th>
<th>Connectivity</th>
<th>Status</th>
<th>Months</th>
<th>Devices</th>
<th>Price</th>
<th>Excl GST</th>
<th>Incl GST</th>
<th>Payment</th>
<th>Start</th>
<th>End</th>
<th>PO Expiry</th>
<th>Service Stop</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="modal" id="modal">
<div class="modal-box">

<form id="salesForm">

<div class="form-grid">

<input name="entity" placeholder="Entity">
<input name="customerName" placeholder="Customer Name">
<input name="speed" placeholder="Speed">
<input name="location" placeholder="Location">

<select name="connectivity">
<option>Fiber</option>
<option>Wireless</option>
<option>LTE</option>
</select>

<select name="deliveryStatus">
<option>Active</option>
<option>Pending</option>
<option>Inactive</option>
</select>

<input name="months" placeholder="Months">
<input name="devices" placeholder="Devices">
<input name="price" placeholder="Price">
<input name="exclGst" placeholder="Excl GST">
<input name="inclGst" placeholder="Incl GST">

<select name="paymentStatus">
<option>Paid</option>
<option>Unpaid</option>
<option>Overdue</option>
</select>

<input type="date" name="paymentDate">
<input type="date" name="startDate">
<input type="date" name="endDate">
<input type="date" name="poExpiryDate">
<input type="date" name="serviceStopDate">

</div>

<br>
<button class="btn">Save</button>
<button type="button" onclick="closeModal()">Cancel</button>

</form>

</div>
</div>


<!-- âœ… SUPABASE LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

/* ðŸ” SUPABASE SETUP */
const supabaseUrl="https://jhvujuqzkjbprmshizcx.supabase.co";
const supabaseKey="sb_publishable_F_SEkmGLAe00CNrXVbce6g_H1LK5006";

const supabase=window.supabase.createClient(
 supabaseUrl,
 supabaseKey
);

let salesData=[];

const tableBody=document.getElementById("tableBody");
const modal=document.getElementById("modal");

function openModal(){ modal.style.display="flex"; }
function closeModal(){ modal.style.display="none"; }

/* LOAD DATA FROM CLOUD */
async function loadData(){

 const {data,error}=await supabase
 .from("sales_entries")
 .select("*")
 .order("id",{ascending:false});

 if(error){
   alert("Load error: "+error.message);
   return;
 }

 salesData=data;
 renderTable();
}

/* RENDER TABLE */
function renderTable(){

 tableBody.innerHTML="";

 salesData.forEach(item=>{

 tableBody.innerHTML+=`
 <tr>
 <td>${item.entity||""}</td>
 <td>${item.customerName||""}</td>
 <td>${item.speed||""}</td>
 <td>${item.location||""}</td>
 <td>${item.connectivity||""}</td>
 <td>${item.deliveryStatus||""}</td>
 <td>${item.months||""}</td>
 <td>${item.devices||""}</td>
 <td>${item.price||""}</td>
 <td>${item.exclGst||""}</td>
 <td>${item.inclGst||""}</td>
 <td>${item.paymentStatus||""}</td>
 <td>${item.startDate||""}</td>
 <td>${item.endDate||""}</td>
 <td>${item.poExpiryDate||""}</td>
 <td>${item.serviceStopDate||""}</td>
 <td><button onclick="deleteEntry(${item.id})">Delete</button></td>
 </tr>`;
 });
}

/* SAVE ENTRY TO CLOUD */
document.getElementById("salesForm").addEventListener("submit",async(e)=>{

 e.preventDefault();

 const formData=new FormData(e.target);
 const entry=Object.fromEntries(formData.entries());

 const {error}=await supabase
 .from("sales_entries")
 .insert([entry]);

 if(error){
   alert("Insert error: "+error.message);
   return;
 }

 e.target.reset();
 closeModal();
 loadData();
});

/* DELETE ENTRY */
async function deleteEntry(id){

 const {error}=await supabase
 .from("sales_entries")
 .delete()
 .eq("id",id);

 if(error){
   alert("Delete error: "+error.message);
   return;
 }

 loadData();
}

/* INITIAL LOAD */
loadData();

</script>

</body>
</html>
